function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function o(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}function i(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function a(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){l=!0,c=t},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw c}}}}function l(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function u(t,e,n){var o=e.get(t);if(!o)throw new TypeError("attempted to set private field on non-instance");if(o.set)o.set.call(t,n);else{if(!o.writable)throw new TypeError("attempted to set read only private field");o.value=n}return n}var s=function(){function t(n){if(e(this,t),this.body="undefined"!=typeof document&&document&&document.body,this.elements=[],this.body&&n)if("string"==typeof n)this.elements=i(document.querySelectorAll(n));else if(n instanceof Node)this.elements=[n];else if(n instanceof NodeList||n instanceof HTMLCollection)this.elements=i(n);else if(Object.prototype.hasOwnProperty.call(n,"length"))for(var o=0;o<n.length;o++)this.elements.push(n[o]);else n instanceof t&&(this.elements=i(n.elements),this.parent=n.parent);this.parent=this.getParentSelection()}return o(t,[{key:"getParentSelection",value:function(){var e=this.elements.map((function(t){return t.parentNode})).filter((function(t){return!!t}));return e.length?new t(e):null}},{key:"query",value:function(e){var n=[];return this.elements.forEach((function(t){var o=i(t.querySelectorAll(e));o.forEach((function(t){-1===n.indexOf(t)&&n.push(o)}))})),new t(n)}},{key:"append",value:function(e){if(this.body){var n;if("string"==typeof e){var o=document.createElement("div");o.innerHTML=e,n=new t(o.childNodes)}else n=new t(e);this.elements.forEach((function(t,e){if(1===n.elements.length)t.appendChild(n.elements[0]);else{var o=document.createDocumentFragment();n.elements.forEach((function(t){o.appendChild(0===e?t:t.cloneNode())})),t.appendChild(o)}}))}return this}},{key:"prepend",value:function(e){return this.body&&this.elements.forEach((function(n){var o=new t(n.childNodes).detach();new t(n).append(e).append(o)})),this}},{key:"detach",value:function(){if(this.body){var e=document.createDocumentFragment();return this.elements.forEach((function(t){e.appendChild(t)})),new t(e)}return this}},{key:"clear",value:function(){return this.body&&this.elements.forEach((function(t){t.innerHTML=""})),this}},{key:"htmlMap",value:function(){return this.map((function(t){return t.innerHTML}))}},{key:"textMap",value:function(){return this.map((function(t){return t.textContent||t.innerText}))}},{key:"map",value:function(t){return this.body&&"function"==typeof t?this.elements.map(t):this.elements}},{key:"getBodyTag",value:function(){return new t(this.body)}},{key:"children",value:function(){var e=[];return this.elements.forEach((function(t){i(t.childNodes).forEach((function(t){-1===e.indexOf(t)&&e.push(t)}))})),new t(e)}},{key:"on",value:function(){var t=arguments;return this.elements.forEach((function(e){e.addEventListener.apply(e,i(t))})),this}},{key:"off",value:function(){var t=arguments;return this.elements.forEach((function(e){e.removeEventListener.apply(e,i(t))})),this}},{key:"once",value:function(t,e,n){var o=this,i=function i(){e.apply(this,arguments),o.elements.forEach((function(e){e.removeEventListener(t,i,n)}))};this.elements.forEach((function(e){e.addEventListener(t,i,n)}))}},{key:"bounds",value:function(){return this.map((function(t){return t.getBoundingClientRect()}))}},{key:"setCSSProps",value:function(t){return this.elements.forEach((function(e){Object.keys(t).forEach((function(n){e.style[n]=t[n]}))})),this}},{key:"setAttr",value:function(t){return this.elements.forEach((function(e){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))})),this}},{key:"getAttrMap",value:function(t){return this.map((function(e){return e.getAttribute(t)}))}},{key:"repaint",value:function(){return this.elements.forEach((function(t){t.offsetHeight})),this}},{key:"contains",value:function(e){var n=this;return-1===new t(e).map((function(t){var e,o=a(n.elements);try{for(o.s();!(e=o.n()).done;){if(e.value.contains(t))return!0}}catch(t){o.e(t)}finally{o.f()}return!1})).indexOf(!1)}}],[{key:"create",value:function(e){return new t(document.createDocumentFragment()).append(e).children()}}]),t}(),f=function(){function t(n,o){e(this,t),this.target=new s(o),this.targetPlacement=this.target.bounds()[0],this.windowProps={width:window.innerWidth,height:window.innerHeight},this.target.setCSSProps({position:"fixed",top:"".concat(this.getClientY(n),"px"),left:"".concat(this.getClientX(n),"px"),maxWidth:"".concat(this.windowProps.width-10,"px"),maxHeight:"".concat(this.windowProps.height-10,"px"),overflow:"auto"})}return o(t,[{key:"getClientX",value:function(t){var e=t.clientX+this.targetPlacement.width-this.windowProps.width;return e>0?t.clientX-e-4:t.clientX}},{key:"getClientY",value:function(t){var e=t.clientY+this.targetPlacement.height-this.windowProps.height;return e>0?t.clientY-e-4:t.clientY}}]),t}(),h=new WeakMap,p=new WeakMap,m=function(){function n(o,i){var r=this;e(this,n),h.set(this,{writable:!0,value:[]}),p.set(this,{writable:!0,value:!1}),i&&"object"===t(i)&&(this.config=Object.freeze(i)),this.contextTarget="string"==typeof o?new s(o):(new s).getBodyTag(),this.isSupported=!!this.contextTarget.body,this.rootElement=s.create(this.config&&this.config.rootElement?this.config.rootElement:'<ul class="context-menu-list"></ul>');var c=this,a=function(t){t.preventDefault(),l(c,p)||(new s(this).append(c.rootElement),new f(t,c.rootElement),c.config&&"function"==typeof c.config.onActivate&&(c.rootElement.repaint(),i.onActivate(c.rootElement),u(c,p,!0)))},m=function(){r.rootElement=r.rootElement.detach().children(),u(r,p,!1)},y=function(){r.config&&"function"==typeof i.onDeactivate?i.onDeactivate(r.rootElement,m):m()},d=function(t){(t.stopPropagation(),r.config&&"function"==typeof r.config.onClick)&&(r.config.onClick.apply(new s(t.target),[t])&&("function"==typeof r.config.onDeactivate?r.config.onDeactivate(r.rootElement,m):m()))};l(this,h).push({onContextMenu:a},{onClick:y},{onRootClick:d}),this.contextTarget.on("contextmenu",a).on("click",y),this.rootElement.on("click",d)}return o(n,[{key:"add",value:function(){var t,e=Array.prototype.slice.call(arguments),n=a(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;(o instanceof y||o instanceof d)&&this.rootElement.append(o.rootElement)}}catch(t){n.e(t)}finally{n.f()}}},{key:"cleanup",value:function(){var t=l(this,h).filter((function(t){return Object.prototype.hasOwnProperty.call(t,"onContextMenu")}))[0].onContextMenu,e=l(this,h).filter((function(t){return Object.prototype.hasOwnProperty.call(t,"onClick")}))[0].onClick,n=l(this,h).filter((function(t){return Object.prototype.hasOwnProperty.call(t,"onRootClick")}))[0].onRootClick;this.contextTarget.off("contextmenu",t).off("click",e),this.rootElement.off("click",n)}}]),n}(),y=function(){function n(o,i){e(this,n),i&&"object"===t(i)&&(this.config=Object.freeze(i)),this.rootElement=s.create(this.config&&this.config.rootElement?this.config.rootElement:'<li class="menu-item"></li>'),this.rootElement.setAttr({"data-has-sub-elements":!0}),this.listElement=s.create(this.config&&this.config.listElement?this.config.listElement:'<ul class="context-submenu"></ul>'),this.rootElement.append(o).append(this.listElement)}return o(n,[{key:"add",value:function(){var t,e=Array.prototype.slice.call(arguments),o=a(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;(i instanceof n||i instanceof d)&&this.listElement.append(i.rootElement)}}catch(t){o.e(t)}finally{o.f()}}},{key:"parent",get:function(){return this.rootElement.parent}}]),n}(),d=function n(o,i){e(this,n),i&&"object"===t(i)&&(this.config=Object.freeze()),this.rootElement=s.create(this.config&&this.config.rootElement?this.config.rootElement:'<li class="menu-item"></li>'),this.rootElement.append(o)};export{d as ContextItem,y as ContextList,m as ContextMenu};
