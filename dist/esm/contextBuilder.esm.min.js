function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function c(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=a(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){c=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw r}}}}function l(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function u(t,e,n){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,n);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=n}return n}var f=function(){function t(n){if(e(this,t),o(this,"body",void 0),o(this,"elements",void 0),o(this,"parent",void 0),this.body="undefined"!=typeof document&&!!document&&document.body,this.elements=[],this.body&&n)if("string"==typeof n)this.elements=r(document.querySelectorAll(n));else if(n instanceof Node||n instanceof EventTarget)this.elements=[n];else if(n instanceof NodeList||n instanceof HTMLCollection)this.elements=r(n);else if(Object.prototype.hasOwnProperty.call(n,"length"))for(var i=0;i<n.length;i++)this.elements.push(n[i]);else n instanceof t&&(this.elements=r(n.elements),this.parent=n.parent);this.parent=this.getParentSelection()}return i(t,[{key:"getParentSelection",value:function(){var e=this.elements.map((function(t){return t.parentNode})).filter((function(t){return!!t}));return e.length?new t(e):null}},{key:"query",value:function(e){var n=[];return this.elements.forEach((function(t){t instanceof HTMLElement&&r(t.querySelectorAll(e)).forEach((function(t){-1===n.indexOf(t)&&n.push(t)}))})),new t(n)}},{key:"append",value:function(e){if(this.body){var n;if("string"==typeof e){var i=document.createElement("div");i.innerHTML=e,n=new t(i.childNodes)}else n=new t(e);this.elements.forEach((function(t,e){if(1===n.elements.length)t.appendChild(n.elements[0]);else{var i=document.createDocumentFragment();n.elements.forEach((function(t){i.appendChild(0===e?t:t.cloneNode())})),t.appendChild(i)}}))}return this}},{key:"prepend",value:function(e){return this.body&&this.elements.forEach((function(n){var i=new t(n.childNodes).detach();new t(n).append(e).append(i)})),this}},{key:"detach",value:function(){if(this.body){var e=document.createDocumentFragment();return this.elements.forEach((function(t){e.appendChild(t)})),new t(e)}return this}},{key:"clear",value:function(){return this.body&&this.elements.forEach((function(t){t instanceof HTMLElement&&(t.innerHTML="")})),this}},{key:"htmlMap",value:function(){return this.map((function(t){return t instanceof HTMLElement?t.innerHTML:""}))}},{key:"textMap",value:function(){return this.map((function(t){return t instanceof HTMLElement?t.textContent||t.innerText:""}))}},{key:"map",value:function(t){return this.body&&"function"==typeof t?this.elements.map(t):this.elements}},{key:"getBodyTag",value:function(){return new t(this.body)}},{key:"children",value:function(){var e=[];return this.elements.forEach((function(t){r(t.childNodes).forEach((function(t){-1===e.indexOf(t)&&e.push(t)}))})),new t(e)}},{key:"on",value:function(t,e,n){return this.elements.forEach((function(i){i.addEventListener(t,e,n)})),this}},{key:"off",value:function(t,e,n){return this.elements.forEach((function(i){i.removeEventListener(t,e,n)})),this}},{key:"once",value:function(t,e,n){var i=this,o=function o(r){e.apply(this,[r]),i.elements.forEach((function(e){e.removeEventListener(t,o,n)}))};return this.elements.forEach((function(e){e.addEventListener(t,o,n)})),this}},{key:"bounds",value:function(){return this.map((function(t){return t instanceof HTMLElement?t.getBoundingClientRect():null}))}},{key:"setCSSProps",value:function(t){return this.elements.forEach((function(e){e instanceof HTMLElement&&Object.keys(t).forEach((function(n){e.style[n]=t[n]}))})),this}},{key:"setAttr",value:function(t){return this.elements.forEach((function(e){e instanceof HTMLElement&&Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))})),this}},{key:"getAttrMap",value:function(t){return this.map((function(e){if(e instanceof HTMLElement)return e.getAttribute(t)}))}},{key:"repaint",value:function(){return this.elements.forEach((function(t){t instanceof HTMLElement&&t.offsetHeight})),this}},{key:"contains",value:function(e){var n=this;return-1===new t(e).map((function(t){var e,i=c(n.elements);try{for(i.s();!(e=i.n()).done;){if(e.value.contains(t))return!0}}catch(t){i.e(t)}finally{i.f()}return!1})).indexOf(!1)}}],[{key:"create",value:function(e){return new t(document.createDocumentFragment()).append(e).children()}}]),t}(),h=function(){function t(n,i){e(this,t),o(this,"target",void 0),o(this,"targetPlacement",void 0),o(this,"windowProps",void 0),this.target=new f(i),this.targetPlacement=this.target.bounds()[0],this.windowProps={width:window.innerWidth,height:window.innerHeight},this.target.setCSSProps({position:"fixed",top:"".concat(this.getClientY(n),"px"),left:"".concat(this.getClientX(n),"px"),maxWidth:"".concat(this.windowProps.width-10,"px"),maxHeight:"".concat(this.windowProps.height-10,"px"),overflow:"auto"})}return i(t,[{key:"getClientX",value:function(t){if(this.targetPlacement){var e=t.clientX+this.targetPlacement.width-this.windowProps.width;if(e>0)return t.clientX-e-4}return t.clientX}},{key:"getClientY",value:function(t){if(this.targetPlacement){var e=t.clientY+this.targetPlacement.height-this.windowProps.height;if(e>0)return t.clientY-e-4}return t.clientY}}]),t}();if("undefined"!=typeof window&&void 0===window.CustomEvent){var d=function t(n,i){e(this,t),i=i||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(n,i.bubbles,i.cancelable,i.detail),o};d.prototype=window.Event.prototype,window.CustomEvent=d}var m=new WeakMap,p=new WeakMap,v=new WeakMap,y=new WeakMap,g=new WeakMap,w=function(){function t(n){var i=this;e(this,t),m.set(this,{writable:!0,value:void 0}),p.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:"closecontextmenu"}),y.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:function(t){var e=t.detail.originContext;"function"==typeof l(i,y)&&l(i,y).call(i,e!==l(i,m))}}),u(this,m,n),"undefined"!=typeof document&&u(this,p,document.body)}return i(t,[{key:"emit",value:function(){if(l(this,p)){var t=new CustomEvent(l(this,v),{cancelable:!0,bubbles:!0,detail:{originContext:l(this,m)}});l(this,p).dispatchEvent(t)}}},{key:"listen",value:function(t){var e;u(this,y,t),null===(e=l(this,p))||void 0===e||e.addEventListener(l(this,v),l(this,g))}},{key:"off",value:function(){var t;null===(t=l(this,p))||void 0===t||t.removeEventListener(l(this,v),l(this,g)),u(this,y,void 0)}}]),t}(),b=new WeakMap,E=new WeakMap,k=new WeakMap,T=new WeakMap,x=new WeakMap,M=new WeakMap,C=new WeakMap,S=function(){function n(i,r){var a=this;e(this,n),b.set(this,{writable:!0,value:!1}),E.set(this,{writable:!0,value:!1}),k.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:function(){a.rootElement=a.rootElement.detach().children(),u(a,b,!1),u(a,E,!1)}}),x.set(this,{writable:!0,value:function(){l(a,E)&&(a.config&&"function"==typeof a.config.onDeactivate?(u(a,b,!0),a.config.onDeactivate(a.rootElement,l(a,T))):l(a,T).call(a))}}),M.set(this,{writable:!0,value:function(t){t.preventDefault(),t.stopPropagation(),l(a,k).emit(),u(a,E,!0),l(a,b)||(a.contextTarget.append(a.rootElement),new h(t,a.rootElement),a.config&&"function"==typeof a.config.onActivate&&(a.rootElement.repaint(),a.config.onActivate(a.rootElement)))}}),C.set(this,{writable:!0,value:function(t){(t.stopPropagation(),a.config&&"function"==typeof a.config.onClick)&&(a.config.onClick.apply(new f(t.target),[t])&&l(a,x).call(a))}}),o(this,"contextTarget",void 0),o(this,"isSupported",void 0),o(this,"rootElement",void 0),o(this,"config",{}),u(this,k,new w(this)),r&&"object"===t(r)&&(this.config=Object.freeze(r)),this.contextTarget="string"==typeof i?new f(i):(new f).getBodyTag(),this.isSupported=!!this.contextTarget.body,this.rootElement=f.create(this.config&&this.config.rootElement?this.config.rootElement:'<ul class="context-menu-list"></ul>'),this.contextTarget.on("contextmenu",l(this,M)),this.contextTarget.body&&new f(this.contextTarget.body).on("click",l(this,x)),l(this,k).listen((function(t){t&&l(a,x).call(a)})),this.rootElement.on("click",l(this,C))}return i(n,[{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i,o=[].concat(e),r=c(o);try{for(r.s();!(i=r.n()).done;){var a=i.value;(a instanceof P||a instanceof A)&&this.rootElement.append(a.rootElement)}}catch(t){r.e(t)}finally{r.f()}return this}},{key:"cleanup",value:function(){this.contextTarget.off("contextmenu",l(this,M)).off("click",l(this,x)),this.rootElement.off("click",l(this,C)),l(this,k).off()}}]),n}(),P=function(){function n(i,r){e(this,n),o(this,"config",{}),o(this,"rootElement",void 0),o(this,"listElement",void 0),r&&"object"===t(r)&&(this.config=Object.freeze(r)),this.rootElement=f.create(this.config&&this.config.rootElement?this.config.rootElement:'<li class="menu-item"></li>'),this.rootElement.setAttr({"data-has-sub-elements":!0}),this.listElement=f.create(this.config&&this.config.listElement?this.config.listElement:'<ul class="context-submenu"></ul>'),this.rootElement.append(i).append(this.listElement)}return i(n,[{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var o,r=[].concat(e),a=c(r);try{for(a.s();!(o=a.n()).done;){var s=o.value;(s instanceof n||s instanceof A)&&this.listElement.append(s.rootElement)}}catch(t){a.e(t)}finally{a.f()}return this}},{key:"parent",get:function(){return this.rootElement.parent}}]),n}(),A=function n(i,r){e(this,n),o(this,"config",{}),o(this,"rootElement",void 0),r&&"object"===t(r)&&(this.config=Object.freeze(r)),this.rootElement=f.create(this.config&&this.config.rootElement?this.config.rootElement:'<li class="menu-item"></li>'),this.rootElement.append(i)};export{A as ContextItem,P as ContextList,S as ContextMenu};
