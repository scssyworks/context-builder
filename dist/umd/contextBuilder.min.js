!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).contextBuilder={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function l(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=s(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw r}}}}function u(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function f(t,e,n){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,n);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=n}return n}var h=function(){function t(e){if(n(this,t),r(this,"body",void 0),r(this,"elements",void 0),r(this,"parent",void 0),this.body="undefined"!=typeof document&&!!document&&document.body,this.elements=[],this.body&&e)if("string"==typeof e)this.elements=a(document.querySelectorAll(e));else if(e instanceof Node||e instanceof EventTarget)this.elements=[e];else if(e instanceof NodeList||e instanceof HTMLCollection)this.elements=a(e);else if(Object.prototype.hasOwnProperty.call(e,"length"))for(var i=0;i<e.length;i++)this.elements.push(e[i]);else e instanceof t&&(this.elements=a(e.elements),this.parent=e.parent);this.parent=this.getParentSelection()}return o(t,[{key:"getParentSelection",value:function(){var e=this.elements.map((function(t){return t.parentNode})).filter((function(t){return!!t}));return e.length?new t(e):null}},{key:"query",value:function(e){var n=[];return this.elements.forEach((function(t){t instanceof HTMLElement&&a(t.querySelectorAll(e)).forEach((function(t){-1===n.indexOf(t)&&n.push(t)}))})),new t(n)}},{key:"append",value:function(e){if(this.body){var n;if("string"==typeof e){var i=document.createElement("div");i.innerHTML=e,n=new t(i.childNodes)}else n=new t(e);this.elements.forEach((function(t,e){if(1===n.elements.length)t.appendChild(n.elements[0]);else{var i=document.createDocumentFragment();n.elements.forEach((function(t){i.appendChild(0===e?t:t.cloneNode())})),t.appendChild(i)}}))}return this}},{key:"prepend",value:function(e){return this.body&&this.elements.forEach((function(n){var i=new t(n.childNodes).detach();new t(n).append(e).append(i)})),this}},{key:"detach",value:function(){if(this.body){var e=document.createDocumentFragment();return this.elements.forEach((function(t){e.appendChild(t)})),new t(e)}return this}},{key:"clear",value:function(){return this.body&&this.elements.forEach((function(t){t instanceof HTMLElement&&(t.innerHTML="")})),this}},{key:"htmlMap",value:function(){return this.map((function(t){return t instanceof HTMLElement?t.innerHTML:""}))}},{key:"textMap",value:function(){return this.map((function(t){return t instanceof HTMLElement?t.textContent||t.innerText:""}))}},{key:"map",value:function(t){return this.body&&"function"==typeof t?this.elements.map(t):this.elements}},{key:"getBodyTag",value:function(){return new t(this.body)}},{key:"children",value:function(){var e=[];return this.elements.forEach((function(t){a(t.childNodes).forEach((function(t){-1===e.indexOf(t)&&e.push(t)}))})),new t(e)}},{key:"on",value:function(t,e,n){return this.elements.forEach((function(i){i.addEventListener(t,e,n)})),this}},{key:"off",value:function(t,e,n){return this.elements.forEach((function(i){i.removeEventListener(t,e,n)})),this}},{key:"once",value:function(t,e,n){var i=this,o=function o(r){e.apply(this,[r]),i.elements.forEach((function(e){e.removeEventListener(t,o,n)}))};return this.elements.forEach((function(e){e.addEventListener(t,o,n)})),this}},{key:"bounds",value:function(){return this.map((function(t){return t instanceof HTMLElement?t.getBoundingClientRect():null}))}},{key:"setCSSProps",value:function(t){return this.elements.forEach((function(e){e instanceof HTMLElement&&Object.keys(t).forEach((function(n){e.style[n]=t[n]}))})),this}},{key:"setAttr",value:function(t){return this.elements.forEach((function(e){e instanceof HTMLElement&&Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))})),this}},{key:"getAttrMap",value:function(t){return this.map((function(e){if(e instanceof HTMLElement)return e.getAttribute(t)}))}},{key:"repaint",value:function(){return this.elements.forEach((function(t){t instanceof HTMLElement&&t.offsetHeight})),this}},{key:"contains",value:function(e){var n=this;return-1===new t(e).map((function(t){var e,i=l(n.elements);try{for(i.s();!(e=i.n()).done;){if(e.value.contains(t))return!0}}catch(t){i.e(t)}finally{i.f()}return!1})).indexOf(!1)}}],[{key:"create",value:function(e){return new t(document.createDocumentFragment()).append(e).children()}}]),t}(),d=function(){function t(e,i){n(this,t),r(this,"target",void 0),r(this,"targetPlacement",void 0),r(this,"windowProps",void 0),this.target=new h(i),this.targetPlacement=this.target.bounds()[0],this.windowProps={width:window.innerWidth,height:window.innerHeight},this.target.setCSSProps({position:"fixed",top:"".concat(this.getClientY(e),"px"),left:"".concat(this.getClientX(e),"px"),maxWidth:"".concat(this.windowProps.width-10,"px"),maxHeight:"".concat(this.windowProps.height-10,"px"),overflow:"auto"})}return o(t,[{key:"getClientX",value:function(t){if(this.targetPlacement){var e=t.clientX+this.targetPlacement.width-this.windowProps.width;if(e>0)return t.clientX-e-4}return t.clientX}},{key:"getClientY",value:function(t){if(this.targetPlacement){var e=t.clientY+this.targetPlacement.height-this.windowProps.height;if(e>0)return t.clientY-e-4}return t.clientY}}]),t}();if("undefined"!=typeof window&&void 0===window.CustomEvent){var m=function t(e,i){n(this,t),i=i||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,i.bubbles,i.cancelable,i.detail),o};m.prototype=window.Event.prototype,window.CustomEvent=m}var p=new WeakMap,v=new WeakMap,y=new WeakMap,g=new WeakMap,w=new WeakMap,b=function(){function t(e){var i=this;n(this,t),p.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:"closecontextmenu"}),g.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:function(t){var e=t.detail.originContext;"function"==typeof u(i,g)&&u(i,g).call(i,e!==u(i,p))}}),f(this,p,e),"undefined"!=typeof document&&f(this,v,document)}return o(t,[{key:"emit",value:function(){if(u(this,v)){var t=new CustomEvent(u(this,y),{cancelable:!0,bubbles:!0,detail:{originContext:u(this,p)}});u(this,v).dispatchEvent(t)}}},{key:"listen",value:function(t){var e;f(this,g,t),null===(e=u(this,v))||void 0===e||e.addEventListener(u(this,y),u(this,w))}},{key:"off",value:function(){var t;null===(t=u(this,v))||void 0===t||t.removeEventListener(u(this,y),u(this,w)),f(this,g,void 0)}}]),t}(),E=new WeakMap,k=new WeakMap,x=new WeakMap,M=new WeakMap,T=new WeakMap,C=new WeakMap,S=new WeakMap,P=function(){function t(i,o){var a=this;n(this,t),E.set(this,{writable:!0,value:!1}),k.set(this,{writable:!0,value:!1}),x.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:function(){a.rootElement=a.rootElement.detach().children(),f(a,E,!1),f(a,k,!1)}}),T.set(this,{writable:!0,value:function(){u(a,k)&&(a.config&&"function"==typeof a.config.onDeactivate?(f(a,E,!0),a.config.onDeactivate(a.rootElement,u(a,M))):u(a,M).call(a))}}),C.set(this,{writable:!0,value:function(t){t.preventDefault(),t.stopPropagation(),u(a,x).emit(),f(a,k,!0),u(a,E)||(a.contextTarget.append(a.rootElement),new d(t,a.rootElement),a.config&&"function"==typeof a.config.onActivate&&(a.rootElement.repaint(),a.config.onActivate(a.rootElement)))}}),S.set(this,{writable:!0,value:function(t){(t.stopPropagation(),a.config&&"function"==typeof a.config.onClick)&&(a.config.onClick.apply(new h(t.target),[t])&&u(a,T).call(a))}}),r(this,"contextTarget",void 0),r(this,"isSupported",void 0),r(this,"rootElement",void 0),r(this,"config",{}),f(this,x,new b(this)),o&&"object"===e(o)&&(this.config=Object.freeze(o)),this.contextTarget="string"==typeof i?new h(i):(new h).getBodyTag(),this.isSupported=!!this.contextTarget.body,this.rootElement=h.create(this.config&&this.config.rootElement?this.config.rootElement:'<ul class="context-menu-list"></ul>'),this.contextTarget.on("contextmenu",u(this,C)),"undefined"!=typeof document&&new h(document).on("click",u(this,T)),u(this,x).listen((function(t){t&&u(a,T).call(a)})),this.rootElement.on("click",u(this,S))}return o(t,[{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i,o=[].concat(e),r=l(o);try{for(r.s();!(i=r.n()).done;){var a=i.value;(a instanceof L||a instanceof A)&&this.rootElement.append(a.rootElement)}}catch(t){r.e(t)}finally{r.f()}return this}},{key:"cleanup",value:function(){this.contextTarget.off("contextmenu",u(this,C)).off("click",u(this,T)),this.rootElement.off("click",u(this,S)),u(this,x).off()}}]),t}(),L=function(){function t(i,o){n(this,t),r(this,"config",{}),r(this,"rootElement",void 0),r(this,"listElement",void 0),o&&"object"===e(o)&&(this.config=Object.freeze(o)),this.rootElement=h.create(this.config&&this.config.rootElement?this.config.rootElement:'<li class="menu-item"></li>'),this.rootElement.setAttr({"data-has-sub-elements":!0}),this.listElement=h.create(this.config&&this.config.listElement?this.config.listElement:'<ul class="context-submenu"></ul>'),this.rootElement.append(i).append(this.listElement)}return o(t,[{key:"add",value:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var o,r=[].concat(n),a=l(r);try{for(a.s();!(o=a.n()).done;){var s=o.value;(s instanceof t||s instanceof A)&&this.listElement.append(s.rootElement)}}catch(t){a.e(t)}finally{a.f()}return this}},{key:"parent",get:function(){return this.rootElement.parent}}]),t}(),A=function t(i,o){n(this,t),r(this,"config",{}),r(this,"rootElement",void 0),o&&"object"===e(o)&&(this.config=Object.freeze(o)),this.rootElement=h.create(this.config&&this.config.rootElement?this.config.rootElement:'<li class="menu-item"></li>'),this.rootElement.append(i)};t.ContextItem=A,t.ContextList=L,t.ContextMenu=P,Object.defineProperty(t,"__esModule",{value:!0})}));
