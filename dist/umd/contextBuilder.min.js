!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).contextBuilder={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function r(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function l(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=c(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){l=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw r}}}}function u(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function s(t,e,n){var o=e.get(t);if(!o)throw new TypeError("attempted to set private field on non-instance");if(o.set)o.set.call(t,n);else{if(!o.writable)throw new TypeError("attempted to set read only private field");o.value=n}return n}var f=function(){function t(e){if(n(this,t),this.body="undefined"!=typeof document&&document&&document.body,this.elements=[],this.body&&e)if("string"==typeof e)this.elements=r(document.querySelectorAll(e));else if(e instanceof Node)this.elements=[e];else if(e instanceof NodeList||e instanceof HTMLCollection)this.elements=r(e);else if(Object.prototype.hasOwnProperty.call(e,"length"))for(var o=0;o<e.length;o++)this.elements.push(e[o]);else e instanceof t&&(this.elements=r(e.elements),this.parent=e.parent);this.parent=this.getParentSelection()}return i(t,[{key:"getParentSelection",value:function(){var e=this.elements.map((function(t){return t.parentNode})).filter((function(t){return!!t}));return e.length?new t(e):null}},{key:"query",value:function(e){var n=[];return this.elements.forEach((function(t){var o=r(t.querySelectorAll(e));o.forEach((function(t){-1===n.indexOf(t)&&n.push(o)}))})),new t(n)}},{key:"append",value:function(e){if(this.body){var n;if("string"==typeof e){var o=document.createElement("div");o.innerHTML=e,n=new t(o.childNodes)}else n=new t(e);this.elements.forEach((function(t,e){if(1===n.elements.length)t.appendChild(n.elements[0]);else{var o=document.createDocumentFragment();n.elements.forEach((function(t){o.appendChild(0===e?t:t.cloneNode())})),t.appendChild(o)}}))}return this}},{key:"prepend",value:function(e){return this.body&&this.elements.forEach((function(n){var o=new t(n.childNodes).detach();new t(n).append(e).append(o)})),this}},{key:"detach",value:function(){if(this.body){var e=document.createDocumentFragment();return this.elements.forEach((function(t){e.appendChild(t)})),new t(e)}return this}},{key:"clear",value:function(){return this.body&&this.elements.forEach((function(t){t.innerHTML=""})),this}},{key:"htmlMap",value:function(){return this.map((function(t){return t.innerHTML}))}},{key:"textMap",value:function(){return this.map((function(t){return t.textContent||t.innerText}))}},{key:"map",value:function(t){return this.body&&"function"==typeof t?this.elements.map(t):this.elements}},{key:"getBodyTag",value:function(){return new t(this.body)}},{key:"children",value:function(){var e=[];return this.elements.forEach((function(t){r(t.childNodes).forEach((function(t){-1===e.indexOf(t)&&e.push(t)}))})),new t(e)}},{key:"on",value:function(){var t=arguments;return this.elements.forEach((function(e){e.addEventListener.apply(e,r(t))})),this}},{key:"off",value:function(){var t=arguments;return this.elements.forEach((function(e){e.removeEventListener.apply(e,r(t))})),this}},{key:"once",value:function(t,e,n){var o=this,i=function i(){e.apply(this,arguments),o.elements.forEach((function(e){e.removeEventListener(t,i,n)}))};this.elements.forEach((function(e){e.addEventListener(t,i,n)}))}},{key:"bounds",value:function(){return this.map((function(t){return t.getBoundingClientRect()}))}},{key:"setCSSProps",value:function(t){return this.elements.forEach((function(e){Object.keys(t).forEach((function(n){e.style[n]=t[n]}))})),this}},{key:"setAttr",value:function(t){return this.elements.forEach((function(e){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))})),this}},{key:"getAttrMap",value:function(t){return this.map((function(e){return e.getAttribute(t)}))}},{key:"repaint",value:function(){return this.elements.forEach((function(t){t.offsetHeight})),this}},{key:"contains",value:function(e){var n=this;return-1===new t(e).map((function(t){var e,o=l(n.elements);try{for(o.s();!(e=o.n()).done;){if(e.value.contains(t))return!0}}catch(t){o.e(t)}finally{o.f()}return!1})).indexOf(!1)}}],[{key:"create",value:function(e){return new t(document.createDocumentFragment()).append(e).children()}}]),t}(),h=function(){function t(e,o){n(this,t),this.target=new f(o),this.targetPlacement=this.target.bounds()[0],this.windowProps={width:window.innerWidth,height:window.innerHeight},this.target.setCSSProps({position:"fixed",top:"".concat(this.getClientY(e),"px"),left:"".concat(this.getClientX(e),"px"),maxWidth:"".concat(this.windowProps.width-10,"px"),maxHeight:"".concat(this.windowProps.height-10,"px"),overflow:"auto"})}return i(t,[{key:"getClientX",value:function(t){var e=t.clientX+this.targetPlacement.width-this.windowProps.width;return e>0?t.clientX-e-4:t.clientX}},{key:"getClientY",value:function(t){var e=t.clientY+this.targetPlacement.height-this.windowProps.height;return e>0?t.clientY-e-4:t.clientY}}]),t}(),p=new WeakMap,m=new WeakMap,y=function(){function t(o,i){var r=this;n(this,t),p.set(this,{writable:!0,value:[]}),m.set(this,{writable:!0,value:!1}),i&&"object"===e(i)&&(this.config=Object.freeze(i)),this.contextTarget="string"==typeof o?new f(o):(new f).getBodyTag(),this.isSupported=!!this.contextTarget.body,this.rootElement=f.create(this.config&&this.config.rootElement?this.config.rootElement:'<ul class="context-menu-list"></ul>');var c=this,a=function(t){t.preventDefault(),u(c,m)||(new f(this).append(c.rootElement),new h(t,c.rootElement),c.config&&"function"==typeof c.config.onActivate&&(c.rootElement.repaint(),i.onActivate(c.rootElement),s(c,m,!0)))},l=function(){r.rootElement=r.rootElement.detach().children(),s(r,m,!1)},y=function(){r.config&&"function"==typeof i.onDeactivate?i.onDeactivate(r.rootElement,l):l()},d=function(t){(t.stopPropagation(),r.config&&"function"==typeof r.config.onClick)&&(r.config.onClick.apply(new f(t.target),[t])&&("function"==typeof r.config.onDeactivate?r.config.onDeactivate(r.rootElement,l):l()))};u(this,p).push({onContextMenu:a},{onClick:y},{onRootClick:d}),this.contextTarget.on("contextmenu",a).on("click",y),this.rootElement.on("click",d)}return i(t,[{key:"add",value:function(){var t,e=Array.prototype.slice.call(arguments),n=l(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;(o instanceof d||o instanceof v)&&this.rootElement.append(o.rootElement)}}catch(t){n.e(t)}finally{n.f()}}},{key:"cleanup",value:function(){var t=u(this,p).filter((function(t){return Object.prototype.hasOwnProperty.call(t,"onContextMenu")}))[0].onContextMenu,e=u(this,p).filter((function(t){return Object.prototype.hasOwnProperty.call(t,"onClick")}))[0].onClick,n=u(this,p).filter((function(t){return Object.prototype.hasOwnProperty.call(t,"onRootClick")}))[0].onRootClick;this.contextTarget.off("contextmenu",t).off("click",e),this.rootElement.off("click",n)}}]),t}(),d=function(){function t(o,i){n(this,t),i&&"object"===e(i)&&(this.config=Object.freeze(i)),this.rootElement=f.create(this.config&&this.config.rootElement?this.config.rootElement:'<li class="menu-item"></li>'),this.rootElement.setAttr({"data-has-sub-elements":!0}),this.listElement=f.create(this.config&&this.config.listElement?this.config.listElement:'<ul class="context-submenu"></ul>'),this.rootElement.append(o).append(this.listElement)}return i(t,[{key:"add",value:function(){var e,n=Array.prototype.slice.call(arguments),o=l(n);try{for(o.s();!(e=o.n()).done;){var i=e.value;(i instanceof t||i instanceof v)&&this.listElement.append(i.rootElement)}}catch(t){o.e(t)}finally{o.f()}}},{key:"parent",get:function(){return this.rootElement.parent}}]),t}(),v=function t(o,i){n(this,t),i&&"object"===e(i)&&(this.config=Object.freeze()),this.rootElement=f.create(this.config&&this.config.rootElement?this.config.rootElement:'<li class="menu-item"></li>'),this.rootElement.append(o)};t.ContextItem=v,t.ContextList=d,t.ContextMenu=y,Object.defineProperty(t,"__esModule",{value:!0})}));
